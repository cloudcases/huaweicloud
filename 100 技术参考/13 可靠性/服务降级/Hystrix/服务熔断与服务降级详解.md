# 服务熔断与服务降级详解

发布于2022-11-03 10:54:53阅读 510

为深入理解 **服务雪崩解决方案** 中 **服务熔断** 和 **服务降级** 两个方式，在这儿做一个详解

# 服务熔断

**什么是服务熔断：**

当下游的服务因为某种原因突然变得不可用或响应过慢，上游服务为了保证自己整体服务的可用性，不再继续调用目标服务，直接返回，快速释放资源。如果目标服务情况好转则恢复调用

------

**服务熔断的原理：**

```javascript
业内普遍采用断路器模式
```

原理: 当远程服务被调用时，断路器将监视这个调用，如调用时间太长，断路器将会介入并中断调用。此外，断路器将监视所有对远程资源的调用，如对某一个远程资源的调用失败次数足够多，那么断路器会出现并采取快速失败，阻止将来调用此远程资源的请求.

断路器模式的状态图： 

![img](https://ask.qcloudimg.com/http-save/yehe-8223537/0ca9190c966a82f5fa3ee9c2b3b4260c.jpg?imageView2/2/w/1620);

 解析：

最开始处于closed状态，一旦检测到错误到达一定阈值，便转为open状态；

这时候会有个 reset timeout，到了这个时间了，会转移到half open状态，尝试放行一部分请求到后端，一旦检测成功便回归到closed状态，即恢复服务；

*想不通的朋友可以参考你家的电保险*

```javascript
断路器实现：
阿里公司出的Sentinel
netflix的Hystrix
```

复制

------

**Hystrix中熔断的常用配置：**

**circuitBreaker.requestVolumeThreshold** 默认值20.意思是至少有20个请求才进行errorThresholdPercentage错误百分比计算。比如一段时间（10s）内有19个请求全部失败了。错误百分比是100%，但熔断器不会打开，因为requestVolumeThreshold的值是20. 这个参数非常重要，

**circuitBreaker.sleepWindowInMilliseconds** //过多长时间，熔断器再次检测是否开启，默认为5000，即5s钟

**circuitBreaker.errorThresholdPercentage** //设定错误百分比，默认值50%，例如一段时间（10s）内有100个请求，其中有55个超时或者异常返回了，那么这段时间内的错误百分比是55%，大于了默认值50%，这种情况下触发熔断器-打开。

**按照以上配置的熔断器如下：** 每当20个请求中，有50%失败时，熔断器就会打开，此时再调用此服务，将会直接返回失败，不再调远程服务。直到5s钟之后，重新检测该触发条件，判断是否把熔断器关闭，或者继续打开

------

# 服务降级

服务降级主要有两种场景：

一、当下游的服务因为某种原因响应过慢，下游服务主动停掉一些不太重要的业务，释放出[服务器](https://cloud.tencent.com/product/cvm?from=10680)资源，增加响应速度！

二、当下游的服务因为某种原因不可用，上游主动调用本地的一些降级逻辑，避免卡顿，迅速返回给用户！

```javascript
聪明人已经看出来，第一个场景怎么和服务熔断的概念有异曲同工之妙，没错，服务熔断可视为降级方式的一种！
```



**结合上述场景，在实际的项目中，采用以下的方式来完成降级工作**

1. 梳理出核心业务流程和非核心业务流程。然后在非核心业务流程上加上开关，一旦发现系统扛不住，关掉开关，结束这些次要流程。
2. 一个微服务下肯定有很多功能，那自己区分出主要功能和次要功能。然后次要功能加上开关，需要降级的时候，把次要功能关了吧！
3. 降低一致性了，即将核心业务流程的同步改异步，将强一致性改最终一致性。



版权声明：本文内容由互联网用户自发贡献，该文观点仅代表作者本人。本站仅提供信息存储空间服务，不拥有所有权，不承担相关法律责任。如发现本站有涉嫌侵权/违法违规的内容， 请发送邮件至 举报，一经查实，本站将立刻删除。 

发布者：全栈程序员栈长，转载请注明出处：https://javaforall.cn/180044.html原文链接：https://javaforall.cn

本文参与[ 腾讯云自媒体分享计划](https://cloud.tencent.com/developer/support-plan) ，欢迎热爱写作的你一起参与！

本文分享自作者个人站点/博客：https://javaforall.cn[复制](javascript:void(0);)

如有侵权，请联系 cloudcommunity@tencent.com 删除。



https://cloud.tencent.com/developer/article/2150053?from=article.detail.1843914